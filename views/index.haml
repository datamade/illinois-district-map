.row-fluid
  .span5
    .well
      %h4
        Find candidates in your state house district
        <small>(<a id='find_me' href='#'>find me</a>)</small>

      .input-append
        %input#search_address.span8{:placeholder => "Enter an address or town", :type => "text"}
      
        %input#search.btn.btn-primary{:type => "button", :value => "Search"}
        %button#reset.btn Reset

    .well
      #enter_search
        %p
          This is a tool for exploring 
          %strong Illinois State House Districts 
          and the 
          %strong candidates 
          that run in them.
        %p
          Enter an address above 
          or click the map
          to get started!

      .accordion#results{:style => 'display:none;'}
        %h4 Your State House District

        %ul.inputs-list.unstyled.inline#district-selectors
          %li
            %label.checkbox.inline
              %input#cbtoggle2001{:type => "checkbox"}
              Old:
              %strong.district2001_results.map-2001
          %li
            %label.checkbox.inline
              %input#cbtoggle2011{:type => "checkbox"}
              New:
              %strong.district2011_results.map-2011
          %li
            %label.checkbox.inline
              %input#cbtoggleICAR{:type => "checkbox"}
              ICAR
              (
              %a{:href => '/about#icar'} huh?
              )

        %h4 
          Candidates
          %small
            (
            %a#toggleCandidates{:data_visible => 'true', :href => '#'}
              hide
            )

        #candidates-results
          .accordion-group
            .accordion-heading
              %a.accordion-toggle.map-both{"data-parent" => "#results", "data-toggle" => "collapse", :href => "#resultsBoth"}
                %span#candidatesCountboth
                candidates stayed in your district &raquo;
            .accordion-body.collapse#resultsBoth
              .accordion-inner
                #candidatesListboth.candidate-list

          .accordion-group
            .accordion-heading
              %a.accordion-toggle.map-2011{"data-parent" => "#results", "data-toggle" => "collapse", :href => "#results2011"}
                %span#candidatesCount2011
                added after redistricting &raquo;
            .accordion-body.collapse#results2011
              .accordion-inner
                #candidatesList2011.candidate-list

          .accordion-group
            .accordion-heading
              %a.accordion-toggle.map-2001{"data-parent" => "#results", "data-toggle" => "collapse", :href => "#results2001"}
                %span#candidatesCount2001
                removed after redistricting &raquo;
            .accordion-body.collapse#results2001
              .accordion-inner
                #candidatesList2001.candidate-list

  .span7
    #map_canvas
    %span.pull-right
      Brought to you by
      = succeed "." do
        %a{:href => "http://www.ilcampaign.org/"} Illinois Campaign for Accountable Redistricting
      Website by
      = succeed "." do
        %a{:href => "http://derekeder.com/datamade"} DataMade

- content_for :javascripts do
  = include_javascript :"jquery.address.min"
  = include_javascript :"http://maps.google.com/maps/api/js?sensor=false"
  %script{:src => "/javascripts/fusiontips.js", :type => "text/javascript"}
  %script{:src => "/javascripts/maps_lib.js?19", :type => "text/javascript"}

  :javascript
    $(window).resize(function () {
      var h = $(window).height(),
        offsetTop = 90; // Calculate the top offset
    
      $('#map_canvas').css('height', (h - offsetTop));
    }).resize();
    
    $(function() {
      MapsLib.initialize();

      var toggle2001 = $('#cbtoggle2001');
      toggle2001.click(function(){
        if ( toggle2001.is(':checked'))
          MapsLib.records2001.setMap(map);
        else if (MapsLib.records2001 != null)
          MapsLib.records2001.setMap(null);
      });

      var toggle2011 = $('#cbtoggle2011');
      toggle2011.click(function(){
        if ( toggle2011.is(':checked'))
          MapsLib.records2011.setMap(map);
        else if (MapsLib.records2011 != null) {
          MapsLib.records2011.setMap(null);
        }
      });

      var toggleICAR = $('#cbtoggleICAR');
      toggleICAR.click(function(){
        if ( toggleICAR.is(':checked'))
          MapsLib.recordsICAR.setMap(map);
        else if (MapsLib.recordsICAR != null)
          MapsLib.recordsICAR.setMap(null);
      });

      var toggleCan = $('#toggleCandidates');
      toggleCan.click(function(){
        if ( toggleCan.attr('data_visible') == 'true') {
          toggleCan.attr('data_visible', 'false');
          toggleCan.html('show');
          MapsLib.clearMarkers();
          $('#candidates-results').slideUp();
        }
        else {
          toggleCan.attr('data_visible', 'true');
          toggleCan.html('hide');
          MapsLib.fetchCandidatesForAll();
          $('#candidates-results').slideDown();
        }
        return false;
      });
      
      $('#search').click(function(){
        MapsLib.doSearch();
      });
      
      $('#find_me').click(function(){
        MapsLib.findMe(); 
        return false;
      });
      
      $('#reset').click(function(){
        $.address.parameter('address','');
        MapsLib.initialize(); 
        $('#enter_search').show();
        $('#results').hide();
        return false;
      });
      
      $(":text").keydown(function(e){
          var key =  e.keyCode ? e.keyCode : e.which;
          if(key == 13) {
              $('#search').click();
              return false;
          }
      });
    });